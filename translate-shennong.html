<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯è¿çº¿ç»ƒä¹ </title>
    <style>
        /* ç§»åŠ¨ç«¯é€‚é…çš„åŸºç¡€æ ·å¼ */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            display: flex;
            justify-content: space-around;
            margin: 20px;
            flex-direction: row;
            gap: 10px;
            padding: 0 10px;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 768px) {
            .container {
                flex-direction: row;
                margin: 10px;
                padding: 0 5px;
            }
            .column {
                width: 33% !important;
            }
            .word-item {
                padding: 8px 5px;
                margin: 5px 2px;
                font-size: 12px;
                min-height: 36px;
            }
            .speaker-icon {
                padding: 8px;
                margin-left: 4px;
                font-size: 14px;
                min-width: 30px;
                min-height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        .column {
            width: 30%;
        }
        .word-item {
            margin: 10px 0;
            padding: 10px;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: white;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 50px;
            height: auto;
            word-break: break-word;
        }
        .word-item:hover {
            background-color: #f0f0f0;
        }
        .word-item.selected {
            background-color: #e3f2fd;
            border-color: #2196F3;
        }
        .word-item.matched {
            background-color: #e8f5e9 !important;
            border-color: #81c784 !important;
            cursor: not-allowed !important;
            opacity: 1 !important;
            color: #2e7d32 !important;
            pointer-events: none !important;
            box-shadow: none !important;
        }
        #resetBtn {
            display: block;
            margin: 10px auto;
            padding: 10px 20px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #resetBtn:hover {
            background-color: #d32f2f;
        }
        .speaker-icon {
            display: inline-block;
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #2196F3;
            font-size: 16px;
            padding: 8px;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }
        
        .speaker-icon:hover {
            color: #1976D2;
        }
        .attempt-count {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 12px;
            color: #666;
            background: rgba(0,0,0,0.1);
            padding: 2px 4px;
            border-radius: 4px;
            pointer-events: none;
        }

        #phoneticColumn .word-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-right: 40px; /* ä¸ºå–‡å­å›¾æ ‡ç•™å‡ºç©ºé—´ */
        }

        .stats {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            padding: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1000;
            text-align: center;
            font-size: 18px;
            font-weight: 500;
        }

        .stats span {
            display: inline-block;
            margin: 0 15px;
        }

        .stats .number {
            transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            display: inline-block;
            padding: 0 5px;
            font-weight: 600;
        }

        #successRate.number {
            color: #2196F3;
            font-size: 1.2em;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            background-color: #e3f2fd;
        }

        .stats .number.highlight {
            transform: scale(1.3);
            color: #1976D2;
        }

        #successRate.number.highlight {
            transform: scale(1.4);
            background-color: #bbdefb;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        /* ä¸ºäº†é˜²æ­¢å†…å®¹è¢«å›ºå®šçš„statsé®æŒ¡ï¼Œç»™containeræ·»åŠ ä¸Šè¾¹è· */
        .container {
            margin-top: 70px;
        }
    </style>
</head>
<body>
    <div class="stats">
        <span>æˆåŠŸ: <span id="successCount" class="number">0</span></span>
        <span>å¤±è´¥: <span id="failCount" class="number">0</span></span>
        <span>æˆåŠŸç‡: <span id="successRate" class="number">0%</span></span>
    </div>
    <audio id="tts-audio"></audio>
    <div class="container">
        <div class="column" id="englishColumn">
            <div class="word-item" data-word="divine">divine</div>
            <div class="word-item" data-word="the god of the Divine Farmer">the god of the "Divine Farmer"</div>
            <div class="word-item" data-word="farm">farm (v.)</div>
            <div class="word-item" data-word="because of">because of</div>
            <div class="word-item" data-word="survive">survive</div>
            <div class="word-item" data-word="starvation">starvation</div>
            <div class="word-item" data-word="gradually">gradually</div>
            <div class="word-item" data-word="develop">develop</div>
            <div class="word-item" data-word="agriculture">agriculture</div>
            <div class="word-item" data-word="even though">even though</div>
            <div class="word-item" data-word="no longer">no longer</div>
            <div class="word-item" data-word="in short supply">in short supply</div>
            <div class="word-item" data-word="receive">receive</div>
            <div class="word-item" data-word="medical">medical</div>
            <div class="word-item" data-word="treatment">treatment</div>
            <div class="word-item" data-word="medication">medication</div>
            <div class="word-item" data-word="scarce">scarce</div>
            <div class="word-item" data-word="Be worried about">Be worried about</div>
            <div class="word-item" data-word="believe">believe</div>
            <div class="word-item" data-word="He didn't believe in">He didn't believe in</div>
        </div>
        <div class="column" id="phoneticColumn">
            <div class="word-item" data-word="[dÉªËˆvaÉªn]">/dÉªËˆvaÉªn/</div>
            <div class="word-item" data-word="[Ã°É™ É¡É’d É’v Ã°É™ dÉªËˆvaÉªn ËˆfÉ‘ËmÉ™]">/Ã°É™ É¡É’d É’v Ã°É™ dÉªËˆvaÉªn ËˆfÉ‘ËmÉ™/</div>
            <div class="word-item" data-word="[fÉ‘Ëm]">/fÉ‘Ëm/</div>
            <div class="word-item" data-word="[bÉªËˆkÉ’z É’v]">/bÉªËˆkÉ’z É’v/</div>
            <div class="word-item" data-word="[sÉ™ËˆvaÉªv]">/sÉ™ËˆvaÉªv/</div>
            <div class="word-item" data-word="[stÉ‘ËËˆveÉªÊƒn]">/stÉ‘ËËˆveÉªÊƒn/</div>
            <div class="word-item" data-word="[ËˆÉ¡rÃ¦dÊ’uÉ™li]">/ËˆÉ¡rÃ¦dÊ’uÉ™li/</div>
            <div class="word-item" data-word="[dÉªËˆvelÉ™p]">/dÉªËˆvelÉ™p/</div>
            <div class="word-item" data-word="[ËˆÃ¦É¡rÉªkÊŒltÊƒÉ™]">/ËˆÃ¦É¡rÉªkÊŒltÊƒÉ™/</div>
            <div class="word-item" data-word="[ËˆiËvn Ã°É™ÊŠ]">/ËˆiËvn Ã°É™ÊŠ/</div>
            <div class="word-item" data-word="[nÉ™ÊŠ ËˆlÉ’Å‹É¡É™]">/nÉ™ÊŠ ËˆlÉ’Å‹É¡É™/</div>
            <div class="word-item" data-word="[Éªn ÊƒÉ”Ët sÉ™ËˆplaÉª]">/Éªn ÊƒÉ”Ët sÉ™ËˆplaÉª/</div>
            <div class="word-item" data-word="[rÉªËˆsiËv]">/rÉªËˆsiËv/</div>
            <div class="word-item" data-word="[ËˆmedÉªkl]">/ËˆmedÉªkl/</div>
            <div class="word-item" data-word="[ËˆtriËtmÉ™nt]">/ËˆtriËtmÉ™nt/</div>
            <div class="word-item" data-word="[ËŒmedÉªËˆkeÉªÊƒn]">/ËŒmedÉªËˆkeÉªÊƒn/</div>
            <div class="word-item" data-word="[skeÉ™s]">/skeÉ™s/</div>
            <div class="word-item" data-word="[bi ËˆwÊŒrid É™ËˆbaÊŠt]">/bi ËˆwÊŒrid É™ËˆbaÊŠt/</div>
            <div class="word-item" data-word="[bÉªËˆliËv]">/bÉªËˆliËv/</div>
            <div class="word-item" data-word="[hi dÉªdnt bÉªËˆliËv Éªn]">/hi dÉªdnt bÉªËˆliËv Éªn/</div>
        </div>
        <div class="column" id="chineseColumn">
            <div class="word-item" data-word="ç¥çš„">ç¥çš„</div>
            <div class="word-item" data-word="ç¥å†œå¸">ç¥å†œå¸</div>
            <div class="word-item" data-word="ç§ç”°">ç§ç”°</div>
            <div class="word-item" data-word="ç”±äº">ç”±äº</div>
            <div class="word-item" data-word="ç”Ÿå­˜">ç”Ÿå­˜</div>
            <div class="word-item" data-word="é¥¥é¥¿">é¥¥é¥¿</div>
            <div class="word-item" data-word="é€æ¸åœ°">é€æ¸åœ°</div>
            <div class="word-item" data-word="å‘å±•">å‘å±•</div>
            <div class="word-item" data-word="å†œä¸š">å†œä¸š</div>
            <div class="word-item" data-word="å³ä½¿">å³ä½¿</div>
            <div class="word-item" data-word="ä¸å†">ä¸å†</div>
            <div class="word-item" data-word="ä¾›åº”ä¸è¶³">ä¾›åº”ä¸è¶³</div>
            <div class="word-item" data-word="æ”¶åˆ°">æ”¶åˆ°</div>
            <div class="word-item" data-word="åŒ»å­¦çš„">åŒ»å­¦çš„</div>
            <div class="word-item" data-word="æ²»ç–—">æ²»ç–—</div>
            <div class="word-item" data-word="è¯ç‰©">è¯</div>
            <div class="word-item" data-word="ç¼ºä¹çš„">ç¼ºä¹çš„</div>
            <div class="word-item" data-word="æ‹…å¿ƒ">æ‹…å¿ƒ</div>
            <div class="word-item" data-word="ç›¸ä¿¡">ç›¸ä¿¡</div>
            <div class="word-item" data-word="ä»–ä¸ç›¸ä¿¡">ä»–ä¸ç›¸ä¿¡</div>
        </div>
    </div>
    <button id="resetBtn">é‡ç½®</button>

    <script>
        const answers = {
            'divine': ['/dÉªËˆvaÉªn/', 'ç¥çš„'],
            'the god of the Divine Farmer': ['/Ã°É™ É¡É’d É’v Ã°É™ dÉªËˆvaÉªn ËˆfÉ‘ËmÉ™/', 'ç¥å†œå¸'],
            'farm': ['/fÉ‘Ëm/', 'ç§ç”°'],
            'because of': ['/bÉªËˆkÉ’z É’v/', 'ç”±äº'],
            'survive': ['/sÉ™ËˆvaÉªv/', 'ç”Ÿå­˜'],
            'starvation': ['/stÉ‘ËËˆveÉªÊƒn/', 'é¥¥é¥¿'],
            'gradually': ['/ËˆÉ¡rÃ¦dÊ’uÉ™li/', 'é€æ¸åœ°'],
            'develop': ['/dÉªËˆvelÉ™p/', 'å‘å±•'],
            'agriculture': ['/ËˆÃ¦É¡rÉªkÊŒltÊƒÉ™/', 'å†œä¸š'],
            'even though': ['/ËˆiËvn Ã°É™ÊŠ/', 'å³ä½¿'],
            'no longer': ['/nÉ™ÊŠ ËˆlÉ’Å‹É¡É™/', 'ä¸å†'],
            'in short supply': ['/Éªn ÊƒÉ”Ët sÉ™ËˆplaÉª/', 'ä¾›åº”ä¸è¶³'],
            'receive': ['/rÉªËˆsiËv/', 'æ”¶åˆ°'],
            'medical': ['/ËˆmedÉªkl/', 'åŒ»å­¦çš„'],
            'treatment': ['/ËˆtriËtmÉ™nt/', 'æ²»ç–—'],
            'medication': ['/ËŒmedÉªËˆkeÉªÊƒn/', 'è¯ç‰©'],
            'scarce': ['/skeÉ™s/', 'ç¼ºä¹çš„'],
            'Be worried about': ['/bi ËˆwÊŒrid É™ËˆbaÊŠt/', 'æ‹…å¿ƒ'],
            'believe': ['/bÉªËˆliËv/', 'ç›¸ä¿¡'],
            'He didn\'t believe in': ['/hi dÉªdnt bÉªËˆliËv Éªn/', 'ä»–ä¸ç›¸ä¿¡']
        };

        let selectedItems = {
            english: null,
            phonetic: null,
            chinese: null
        };

        // è®°å½•æ¯ä¸ªæ ¼å­çš„å°è¯•æ¬¡æ•°
        const attemptCounts = new Map();

        // æ›´æ–°å°è¯•æ¬¡æ•°æ˜¾ç¤º
        function updateAttemptCount(item) {
            const count = (attemptCounts.get(item) || 0) + 1;
            attemptCounts.set(item, count);
            
            let countDisplay = item.querySelector('.attempt-count');
            if (!countDisplay) {
                countDisplay = document.createElement('span');
                countDisplay.className = 'attempt-count';
                item.appendChild(countDisplay);
            }
            countDisplay.textContent = count;
        }

        document.querySelectorAll('.word-item').forEach(item => {
            if (!item.classList.contains('matched')) {
                item.addEventListener('click', handleItemClick);
            }
        });

        function handleItemClick(e) {
            const item = e.target;
            if (item.classList.contains('matched')) {
                return;
            }

            const column = item.parentElement.id;
            const columnType = column.replace('Column', '');

            // å¦‚æœå·²ç»é€‰ä¸­äº†è¿™ä¸€åˆ—çš„å…¶ä»–é¡¹ï¼Œå…ˆå–æ¶ˆé€‰ä¸­
            const currentSelected = selectedItems[columnType];
            if (currentSelected && currentSelected !== item) {
                currentSelected.classList.remove('selected');
            }

            // å¦‚æœæ˜¯éŸ³æ ‡åˆ—ï¼Œè‡ªåŠ¨å‘éŸ³
            if (columnType === 'phonetic') {
                const phoneticWord = item.dataset.word.replace('[', '/').replace(']', '/');
                for (const [key, value] of Object.entries(answers)) {
                    if (value[0] === phoneticWord) {
                        speak(key.replace(/["']/g, ''));
                        break;
                    }
                }
            }

            // åˆ‡æ¢é¡¹çš„é€‰ä¸­çŠ¶æ€
            if (item === currentSelected) {
                // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰é€‰ä¸­çš„é¡¹ï¼Œå–æ¶ˆé€‰ä¸­
                item.classList.remove('selected');
                selectedItems[columnType] = null;
            } else {
                // å¦åˆ™é€‰ä¸­æ–°é¡¹
                item.classList.add('selected');
                selectedItems[columnType] = item;
            }

            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (selectedItems.english && selectedItems.phonetic && selectedItems.chinese) {
                checkMatch();
            }
        }

        // æ·»åŠ è®¡æ•°å™¨å’Œè®¡æ—¶å™¨
        let successCount = 0;
        let failCount = 0;
        const startTime = Date.now();

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const successElem = document.getElementById('successCount');
            const failElem = document.getElementById('failCount');
            const rateElem = document.getElementById('successRate');
            
            // æ›´æ–°æ•°å€¼å¹¶æ·»åŠ é«˜äº®åŠ¨ç”»
            function updateWithAnimation(elem, newValue) {
                elem.textContent = newValue;
                elem.classList.add('highlight');
                setTimeout(() => elem.classList.remove('highlight'), 500);
            }

            // æ›´æ–°æˆåŠŸæ¬¡æ•°
            updateWithAnimation(successElem, successCount);
            
            // æ›´æ–°å¤±è´¥æ¬¡æ•°
            updateWithAnimation(failElem, failCount);
            
            // æ›´æ–°æˆåŠŸç‡
            const total = successCount + failCount;
            const rate = total === 0 ? 0 : Math.round((successCount / total) * 100);
            updateWithAnimation(rateElem, rate + '%');
        }

        function checkMatch() {
            if (selectedItems.english && selectedItems.phonetic && selectedItems.chinese) {
                const englishWord = selectedItems.english.dataset.word;
                const phoneticWord = selectedItems.phonetic.dataset.word.replace('[', '/').replace(']', '/');
                const chineseWord = selectedItems.chinese.dataset.word;

                if (answers[englishWord] && 
                    answers[englishWord][0] === phoneticWord && 
                    answers[englishWord][1] === chineseWord) {
                    successCount++;
                    updateStats();
                    
                    // æ›´æ–°å°è¯•æ¬¡æ•°ï¼ˆæˆåŠŸæ—¶ï¼‰
                    [selectedItems.english, selectedItems.phonetic, selectedItems.chinese].forEach(item => {
                        if (item) {
                            updateAttemptCount(item);
                        }
                    });

                    [selectedItems.english, selectedItems.phonetic, selectedItems.chinese].forEach(item => {
                        item.classList.remove('selected');
                        item.classList.add('matched');
                    });

                    // é‡ç½®é€‰ä¸­çŠ¶æ€
                    selectedItems = {
                        english: null,
                        phonetic: null,
                        chinese: null
                    };

                    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å•è¯éƒ½åŒ¹é…æˆåŠŸ
                    const unmatchedItems = document.querySelectorAll('.word-item:not(.matched)');
                    if (unmatchedItems.length === 0) {
                        const totalSeconds = Math.round((Date.now() - startTime) / 1000);
                        const minutes = Math.floor(totalSeconds / 60);
                        const seconds = totalSeconds % 60;
                        const timeText = minutes > 0 ? 
                            `${minutes}åˆ†${seconds}ç§’` : 
                            `${seconds}ç§’`;
                        
                        // æ”¶é›†é…å¯¹å¤±è´¥è¿‡çš„è¯è¯­
                        const failedWordsMap = new Map();
                        document.querySelectorAll('#englishColumn .word-item').forEach(item => {
                            const count = attemptCounts.get(item) || 0;
                            if (count > 1) {  // å¦‚æœå°è¯•æ¬¡æ•°å¤§äº1ï¼Œè¯´æ˜æœ‰å¤±è´¥
                                // ç§»é™¤å¯èƒ½å­˜åœ¨çš„å°è¯•æ¬¡æ•°æ˜¾ç¤ºï¼Œåªä¿ç•™å•è¯æœ¬èº«
                                const wordText = item.textContent.replace(/\s*\d+$/, '').trim();
                                failedWordsMap.set(wordText, count);
                            }
                        });

                        // æŒ‰é”™è¯¯æ¬¡æ•°ä»å¤§åˆ°å°æ’åº
                        const sortedFailedWords = Array.from(failedWordsMap.entries())
                            .sort((a, b) => b[1] - a[1])
                            .map(([word, count]) => `${word.trim()} ${count}æ¬¡`);

                        // æ„å»ºåº†ç¥æ–‡æœ¬
                        let celebrationText = `ğŸ‰ æ­å–œï¼ä½ å·²å®Œæˆæ‰€æœ‰å•è¯çš„åŒ¹é…ï¼\næ€»ç”¨æ—¶ï¼š${timeText}`;
                        if (sortedFailedWords.length > 0) {
                            celebrationText += `\n\néœ€è¦åŠ å¼ºè®°å¿†çš„è¯è¯­ï¼š\n${sortedFailedWords.join('\n')}\n\nç»§ç»­åŠ æ²¹ï¼`;
                        }

                        const celebration = document.createElement('div');
                        celebration.textContent = celebrationText;
                        celebration.style.cssText = `
                            position: fixed;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background-color: rgba(76, 175, 80, 0.9);
                            color: white;
                            padding: 20px 40px;
                            border-radius: 8px;
                            font-size: 18px;
                            z-index: 1000;
                            text-align: center;
                            white-space: pre-line;
                            max-height: 80vh;
                            overflow-y: auto;
                        `;
                        document.body.appendChild(celebration);
                        setTimeout(() => celebration.remove(), 10000);  // å¢åŠ æ˜¾ç¤ºæ—¶é—´åˆ°10ç§’
                    }
                } else {
                    failCount++;
                    updateStats();
                    
                    // æ›´æ–°å°è¯•æ¬¡æ•°
                    [selectedItems.english, selectedItems.phonetic, selectedItems.chinese].forEach(item => {
                        if (item) {
                            updateAttemptCount(item);
                            item.classList.remove('selected');
                        }
                    });
                    
                    // é‡ç½®é€‰ä¸­çŠ¶æ€
                    selectedItems = {
                        english: null,
                        phonetic: null,
                        chinese: null
                    };

                    const tip = document.createElement('div');
                    tip.textContent = 'åŒ¹é…ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•';
                    tip.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background-color: rgba(244, 67, 54, 0.9);
                        color: white;
                        padding: 10px 20px;
                        border-radius: 4px;
                        z-index: 1000;
                    `;
                    document.body.appendChild(tip);
                    setTimeout(() => tip.remove(), 1500);
                }
            }
        }

        // æ·»åŠ æœºæ’å‡½æ•°
        function shuffleChildren(parent) {
            const children = Array.from(parent.children);
            for (let i = children.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                parent.appendChild(children[j]);
            }
        }

        // é¡µé¢è½½æ—¶éšæœºæ’åº
        window.addEventListener('load', () => {
            const columns = document.querySelectorAll('.column');
            columns.forEach(column => shuffleChildren(column));
        });

        // é‡ç½®æŒ‰é’®ä¹Ÿè¦éšæœºæ’åº
        document.getElementById('resetBtn').addEventListener('click', () => {
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            successCount = 0;
            failCount = 0;
            let startTime = Date.now();
            updateStats();
            attemptCounts.clear();
            
            // ç§»é™¤æ‰€æœ‰é€‰ä¸­å’ŒåŒ¹é…çŠ¶æ€
            document.querySelectorAll('.word-item').forEach(item => {
                item.classList.remove('matched', 'selected');
                // ç§»é™¤å°è¯•æ¬¡æ•°æ˜¾ç¤º
                const countDisplay = item.querySelector('.attempt-count');
                if (countDisplay) {
                    countDisplay.remove();
                }
                // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
                item.removeEventListener('click', handleItemClick);
                // é‡æ–°æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                item.addEventListener('click', handleItemClick);
            });

            // é‡ç½®é€‰ä¸­çŠ¶æ€
            selectedItems = {
                english: null,
                phonetic: null,
                chinese: null
            };

            // é‡æ–°éšæœºæ’åº
            const columns = document.querySelectorAll('.column');
            columns.forEach(column => shuffleChildren(column));

            // é‡æ–°åˆå§‹åŒ–éŸ³æ ‡åˆ—çš„å–‡å­å›¾æ ‡
            document.querySelectorAll('#phoneticColumn .word-item').forEach(item => {
                const phoneticWord = item.dataset.word.replace('[', '/').replace(']', '/');
                let englishWord = '';
                for (const [key, value] of Object.entries(answers)) {
                    if (value[0] === phoneticWord) {
                        englishWord = key.replace(/["']/g, '');
                        break;
                    }
                }
                const phoneticText = item.textContent.replace('ğŸ”Š', '').trim();
                item.innerHTML = `
                    ${phoneticText}
                    <span class="speaker-icon" data-speak="${englishWord}">
                        ğŸ”Š
                    </span>
                `;
            });
        });

        // åˆ›å»ºå‘éŸ³å‡½æ•°
        function speak(text) {
            try {
                // ç¡®ä¿è¯­éŸ³åˆæˆå·²åˆå§‹åŒ–
                if (!window.speechSynthesis) {
                    console.error('Speech synthesis not supported');
                    return;
                }
                
                // ç§»é™¤éŸ³æ ‡ä¸­çš„æ–¹æ‹¬å·å’Œå…¶ä»–ç‰¹æ®Šå­—ç¬¦
                const cleanText = text.replace(/[\[\]]/g, '').replace(/Ëˆ|ËŒ/g, '');
                
                // å–æ¶ˆæ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„å‘éŸ³
                window.speechSynthesis.cancel();
                
                // åˆ›å»ºæ–°çš„å‘éŸ³è¯·æ±‚
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'en-US';
                // è·å–æ‰€æœ‰å¯ç”¨çš„è¯­éŸ³
                const voices = window.speechSynthesis.getVoices();
                // æŒ‰ä¼˜å…ˆçº§é€‰æ‹©ç”·å£°
                const voice = voices.find(v => 
                    v.name.includes('Google US English Male') ||  // Android ç¾å¼ç”·å£°
                    v.name.includes('Microsoft David') ||     // Windows ç”·å£°
                    v.name.includes('Alex') ||               // Mac ç”·å£°
                    v.name.includes('Male') ||              // å…¶ä»–ç”·å£°
                    v.name.includes('è‹±è¯­') ||              // ä¸­æ–‡ç³»ç»Ÿçš„è‹±è¯­å£°éŸ³
                    v.lang.startsWith('en-')               // ä»»ä½•è‹±è¯­å£°éŸ³
                );
                if (voice) {
                    utterance.voice = voice;
                }
                utterance.rate = 0.9;  // ç¨å¾®æ…¢ä¸€ç‚¹çš„è¯­é€Ÿ
                utterance.volume = 1;
                utterance.pitch = 0.9;  // ç¨å¾®ä½ä¸€ç‚¹çš„éŸ³è°ƒ
                
                // æ·»åŠ é”™è¯¯å¤„ç†
                utterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                };
                
                // å°è¯•æ’­æ”¾
                window.speechSynthesis.speak(utterance);
            } catch (error) {
                console.error('Speech synthesis error:', error);
            }
        }

        // ç¡®ä¿è¯­éŸ³åˆ—å·²åŠ è½½
        if (window.speechSynthesis) {
            window.speechSynthesis.onvoiceschanged = () => {
                const voices = window.speechSynthesis.getVoices();
                console.log('Available voices:', voices.map(v => v.name));
            };
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        window.addEventListener('load', () => {
            // è§¦å‘ä¸€æ¬¡é™éŸ³çš„è¯­éŸ³åˆæˆæ¥åˆå§‹åŒ–ç³»ç»Ÿ
            const silence = new SpeechSynthesisUtterance('');
            silence.volume = 0;
            window.speechSynthesis.speak(silence);
        });

        // ä¸ºæ‰€æœ‰éŸ³æ ‡æ·»åŠ å–‡å­å›¾æ ‡å’Œå‘éŸ³åŠŸèƒ½
        document.querySelectorAll('#phoneticColumn .word-item').forEach(item => {
            // æ ¹æ®éŸ³æ ‡æ‰¾åˆ°å¯¹åº”è‹±è¯­å•è¯
            const phoneticWord = item.dataset.word.replace('[', '/').replace(']', '/');
            let englishWord = '';
            for (const [key, value] of Object.entries(answers)) {
                if (value[0] === phoneticWord) {
                    englishWord = key.replace(/["']/g, '');
                    break;
                }
            }

            const phoneticText = item.textContent;
            item.innerHTML = `
                ${phoneticText}
                <span class="speaker-icon" data-speak="${englishWord}">
                    ğŸ”Š
                </span>
            `;
        });

        // ä¸ºå–‡å­å›¾æ ‡æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('click', function(e) {
            if (e.target.closest('.speaker-icon')) {
                e.stopPropagation();
                // è·å–åŒ…å«å–‡å­å›¾æ ‡çš„æ ¼å­
                const wordItem = e.target.closest('.word-item');
                if (wordItem) {
                    // æ¨¡æ‹Ÿç‚¹å‡»æ ¼å­
                    handleItemClick({ target: wordItem });
                }
                // æ’­æ”¾å£°éŸ³
                const speakText = e.target.closest('.speaker-icon').dataset.speak;
                speak(speakText);
            }
        });
    </script>
</body>
</html> 
